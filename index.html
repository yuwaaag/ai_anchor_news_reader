<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>PTN News - AI Visual Engine</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
        .studio { position: relative; width: 100vw; height: 100vh; background: url('studio.jpg') center/cover no-repeat; }

        /* ‡§µ‡§ø‡§ú‡§º‡•Å‡§Ö‡§≤ ‡§¨‡•â‡§ï‡•ç‡§∏ */
        .visual-box { 
            position: absolute; right: 4%; top: 10%; width: 42%; height: 40%; 
            border: 4px solid #00f2ff; border-radius: 12px; overflow: hidden; 
            box-shadow: 0 0 30px rgba(0, 242, 255, 0.5); z-index: 2; background: #000;
        }
        /* ‡§á‡§Æ‡•á‡§ú ‡§™‡§∞ ‡§´‡•á‡§° ‡§á‡§´‡•á‡§ï‡•ç‡§ü */
        #newsImg { width: 100%; height: 100%; object-fit: cover; opacity: 0; transition: opacity 1s ease-in-out; }

        /* ‡§∏‡•ç‡§ï‡•ç‡§∞‡§ø‡§™‡•ç‡§ü ‡§µ‡§ø‡§Ç‡§°‡•ã */
        .script-window { 
            position: absolute; left: 4%; top: 10%; width: 40%; height: 55%; 
            background: rgba(0, 0, 0, 0.8); border-left: 8px solid #ff0000; 
            padding: 30px; box-sizing: border-box; z-index: 2; overflow: hidden;
        }
        #teleprompter { position: relative; font-size: 30px; line-height: 1.6; color: #fff; top: 100%; font-weight: 500; }

        /* ‡§è‡§Ç‡§ï‡§∞ */
        .anchor-box { 
            position: absolute; left: 0; right: 0; bottom: 0; width: 100%; height: 100%; 
            display: flex; justify-content: flex-end; align-items: flex-end; z-index: 10; pointer-events: none; 
        }
        #anchorCanvas { max-width: 60%; max-height: 90%; object-fit: contain; margin-bottom: -5px; }
        #hiddenVid { display: none; }

        /* ‡§ü‡§ø‡§ï‡§∞ */
        .ticker-bar { 
            position: absolute; bottom: 0; width: 100%; height: 80px; 
            background: linear-gradient(90deg, #cc0000, #990000); 
            display: flex; align-items: center; z-index: 20; border-top: 4px solid #fff; 
        }
        marquee { font-size: 36px; font-weight: bold; color: white; text-transform: uppercase; }
    </style>
</head>
<body>

<div class="studio">
    <div class="visual-box"><img id="newsImg" src=""></div>
    <div class="script-window"><div id="teleprompter">‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§®‡•ç‡§Ø‡•Ç‡•õ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç...</div></div>
    <div class="anchor-box"><canvas id="anchorCanvas"></canvas></div>
    <video id="hiddenVid" muted loop crossorigin="anonymous"><source src="anchor_video.mp4" type="video/mp4"></video>
    <div class="ticker-bar"><marquee scrollamount="12" id="flashTicker">PTN NEWS LIVE</marquee></div>
</div>

<script>
    // üî¥ ‡§Ö‡§™‡§®‡•Ä CSV ‡§≤‡§ø‡§Ç‡§ï ‡§Ø‡§π‡§æ‡§Å ‡§°‡§æ‡§≤‡•á‡§Ç
    const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTZcfTxhcB7LltOPkXuTBsQ4CRNa2KZfb6EQ2lxx-eXFVhACj3YI4mH4tSeTSx-K_Wf1sgk0419ZDkf/pub?output=csv"; 

    let newsItems = [];
    let currentNewsIndex = 0;
    let visualTimer = null; // ‡§´‡•ã‡§ü‡•ã ‡§¨‡§¶‡§≤‡§®‡•á ‡§ï‡§æ ‡§ü‡§æ‡§á‡§Æ‡§∞

    const video = document.getElementById('hiddenVid');
    const canvas = document.getElementById('anchorCanvas');
    const ctx = canvas.getContext('2d');
    const imgElement = document.getElementById("newsImg");

    // --- 1. ‡§ï‡•ç‡§∞‡•ã‡§Æ‡§æ ‡§ï‡•Ä (Green Screen) ---
    function renderChroma() {
        if (video.paused || video.ended) return;
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        let frame = ctx.getImageData(0, 0, canvas.width, canvas.height);
        for (let i = 0; i < frame.data.length / 4; i++) {
            let r = frame.data[i * 4 + 0];
            let g = frame.data[i * 4 + 1];
            let b = frame.data[i * 4 + 2];
            if (g > 90 && g > r * 1.4 && g > b * 1.4) { // Green Adjustment
                frame.data[i * 4 + 3] = 0;
            }
        }
        ctx.putImageData(frame, 0, 0);
        requestAnimationFrame(renderChroma);
    }

    // --- 2. AI ‡§á‡§Æ‡•á‡§ú ‡§ú‡•á‡§®‡§∞‡•á‡§ü‡§∞ (The Visual Fix) ---
    function loadNextImage(keyword) {
        // ‡§ï‡•Ä‡§µ‡§∞‡•ç‡§° ‡§ï‡•Ä ‡§∏‡§´‡§æ‡§à (‡§§‡§æ‡§ï‡§ø "America" ‡§∏‡§π‡•Ä ‡§∏‡•á ‡§ú‡§æ‡§è)
        let cleanKeyword = keyword.replace(/[^a-zA-Z0-9 ]/g, "").trim();
        if (!cleanKeyword) cleanKeyword = "News Studio";

        const randomSeed = Math.floor(Math.random() * 99999);
        
        // 1. ‡§™‡•Å‡§∞‡§æ‡§®‡•Ä ‡§á‡§Æ‡•á‡§ú ‡§ï‡•ã ‡§ß‡•Å‡§Ç‡§ß‡§≤‡§æ ‡§ï‡§∞‡•á‡§Ç
        imgElement.style.opacity = "0";

        // 2. ‡§®‡§Ø‡§æ ‡§≤‡§ø‡§Ç‡§ï ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§ï‡§∞‡•á‡§Ç (Pollinations AI)
        // ‡§Ø‡§π ‡§≤‡§ø‡§Ç‡§ï ‡§Ü‡§™‡§ï‡•á ‡§ï‡•Ä‡§µ‡§∞‡•ç‡§° ‡§ï‡•á ‡§π‡§ø‡§∏‡§æ‡§¨ ‡§∏‡•á ‡§§‡•Å‡§∞‡§Ç‡§§ ‡§´‡•ã‡§ü‡•ã ‡§¨‡§®‡§æ‡§è‡§ó‡§æ
        const aiUrl = `https://image.pollinations.ai/prompt/photorealistic_news_footage_of_${encodeURIComponent(cleanKeyword)}?width=800&height=450&nologo=true&seed=${randomSeed}`;

        // 3. ‡§¨‡•à‡§ï‡§ó‡•ç‡§∞‡§æ‡§â‡§Ç‡§° ‡§Æ‡•á‡§Ç ‡§´‡•ã‡§ü‡•ã ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç
        const tempLoader = new Image();
        tempLoader.src = aiUrl;
        
        tempLoader.onload = () => {
            imgElement.src = aiUrl;
            imgElement.style.opacity = "1"; // ‡§´‡•ã‡§ü‡•ã ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§π‡•ã‡§§‡•á ‡§π‡•Ä ‡§¶‡§ø‡§ñ‡§æ‡§è‡§Ç
        };
    }

    // --- 3. CSV ‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡§æ ---
    async function initNews() {
        try {
            const response = await fetch(csvUrl);
            const data = await response.text();
            
            // CSV Parsing (‡§¨‡§π‡•Å‡§§ ‡§∏‡§æ‡§µ‡§ß‡§æ‡§®‡•Ä ‡§∏‡•á ‡§∏‡§´‡§æ‡§à)
            const rows = data.split('\n').slice(1);
            newsItems = rows.map(row => {
                // ‡§Ø‡§π Regex ‡§ï‡•ã‡§ü‡•ç‡§∏ ‡§î‡§∞ ‡§è‡§ï‡•ç‡§∏‡•ç‡§ü‡•ç‡§∞‡§æ ‡§∏‡•ç‡§™‡•á‡§∏ ‡§π‡§ü‡§æ ‡§¶‡•á‡§ó‡§æ
                const cols = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                return {
                    script: cols[0]?.replace(/["\r\n]/g, "").trim(),
                    visual: cols[1]?.replace(/["\r\n]/g, "").trim(),
                    flash: cols[2]?.replace(/["\r\n]/g, "").trim()
                };
            }).filter(item => item.script); // ‡§ñ‡§æ‡§≤‡•Ä ‡§≤‡§æ‡§á‡§® ‡§π‡§ü‡§æ ‡§¶‡•á‡§Ç

            if (newsItems.length > 0) {
                runNewsCycle(); // ‡§®‡•ç‡§Ø‡•Ç‡•õ ‡§∂‡•Å‡§∞‡•Ç
            } else {
                alert("CSV ‡§ñ‡§æ‡§≤‡•Ä ‡§π‡•à ‡§Ø‡§æ ‡§≤‡§ø‡§Ç‡§ï ‡§ó‡§≤‡§§ ‡§π‡•à!");
            }
        } catch (error) {
            console.error(error);
            alert("CSV ‡§≤‡•ã‡§° ‡§®‡§π‡•Ä‡§Ç ‡§π‡•Å‡§à‡•§ ‡§≤‡§ø‡§Ç‡§ï ‡§ö‡•á‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§");
        }
    }

    // --- 4. ‡§®‡•ç‡§Ø‡•Ç‡•õ ‡§ö‡§≤‡§æ‡§®‡•á ‡§ï‡§æ ‡§á‡§Ç‡§ú‡§® ---
    function runNewsCycle() {
        // ‡§è‡§Ç‡§ï‡§∞ ‡§î‡§∞ ‡§ë‡§°‡§ø‡§Ø‡•ã ‡§∞‡§ø‡§∏‡•á‡§ü
        window.speechSynthesis.cancel();
        if (visualTimer) clearInterval(visualTimer);

        const currentNews = newsItems[currentNewsIndex];
        
        // UI ‡§Ö‡§™‡§°‡•á‡§ü
        const prompter = document.getElementById("teleprompter");
        prompter.style.transition = "none";
        prompter.style.top = "100%";
        prompter.innerText = currentNews.script;
        document.getElementById("flashTicker").innerText = "BREAKING NEWS: " + currentNews.flash;

        // --- ‡§µ‡§ø‡§ú‡•Å‡§Ö‡§≤ ‡§≤‡•â‡§ú‡§ø‡§ï ---
        // ‡§™‡§π‡§≤‡•Ä ‡§´‡•ã‡§ü‡•ã ‡§§‡•Å‡§∞‡§Ç‡§§ ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç
        loadNextImage(currentNews.visual);
        
        // ‡§ñ‡§¨‡§∞ ‡§ï‡•á ‡§¶‡•å‡§∞‡§æ‡§® ‡§π‡§∞ 10 ‡§∏‡•á‡§ï‡§Ç‡§° ‡§Æ‡•á‡§Ç ‡§´‡•ã‡§ü‡•ã ‡§¨‡§¶‡§≤‡•á‡§Ç
        visualTimer = setInterval(() => {
            loadNextImage(currentNews.visual);
        }, 10000);

        // --- ‡§ë‡§°‡§ø‡§Ø‡•ã ‡§î‡§∞ ‡§µ‡•Ä‡§°‡§ø‡§Ø‡•ã ---
        const speech = new SpeechSynthesisUtterance(currentNews.script);
        speech.lang = 'hi-IN';
        speech.rate = 0.9; // ‡§è‡§Ç‡§ï‡§∞ ‡§ï‡•Ä ‡§∏‡•ç‡§™‡•Ä‡§°

        speech.onstart = () => {
            video.play();
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            renderChroma();
            
            // ‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü ‡§∏‡•ç‡§ï‡•ç‡§∞‡•â‡§≤ ‡§∂‡•Å‡§∞‡•Ç
            setTimeout(() => {
                const duration = currentNews.script.length * 0.13; // ‡§∏‡•ç‡§ï‡•ç‡§∞‡•â‡§≤ ‡§∏‡•ç‡§™‡•Ä‡§°
                prompter.style.transition = `top ${duration}s linear`;
                prompter.style.top = `-${prompter.offsetHeight + 50}px`;
            }, 500);
        };

        speech.onend = () => {
            video.pause();
            // ‡§Ö‡§ó‡§≤‡•Ä ‡§®‡•ç‡§Ø‡•Ç‡•õ ‡§™‡§∞ ‡§ú‡§æ‡§è‡§Å
            currentNewsIndex++;
            
            // ‡§Ö‡§ó‡§∞ ‡•ô‡§¨‡§∞‡•á‡§Ç ‡§ñ‡§§‡•ç‡§Æ ‡§π‡•ã ‡§ó‡§à‡§Ç, ‡§§‡•ã ‡§∂‡•Å‡§∞‡•Ç ‡§∏‡•á (0)
            if (currentNewsIndex >= newsItems.length) {
                currentNewsIndex = 0;
            }

            // 1 ‡§∏‡•á‡§ï‡§Ç‡§° ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§Ö‡§ó‡§≤‡•Ä ‡§®‡•ç‡§Ø‡•Ç‡•õ ‡§ö‡§≤‡§æ‡§è‡§Ç
            setTimeout(runNewsCycle, 1000);
        };

        window.speechSynthesis.speak(speech);
    }

    // ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡§®‡•á ‡§™‡§∞ ‡§∂‡•Å‡§∞‡•Ç ‡§π‡•ã‡§ó‡§æ
    window.onclick = () => {
        if (newsItems.length === 0) initNews();
    };
</script>
</body>
</html>
