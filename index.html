<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>PTN News - Animated Broadcast</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; font-family: 'Segoe UI', Arial, sans-serif; color: white; }
        
        .studio { 
            position: relative; 
            width: 100vw; 
            height: 100vh; 
            background: url('studio.jpg') center/cover no-repeat; 
            background-size: cover; 
            animation: fadeIn 2s ease-out;
        }

        /* ‡§¶‡§æ‡§à‡§Ç ‡§§‡§∞‡§´ ‡§ï‡§æ ‡§®‡•ç‡§Ø‡•Ç‡§ú‡§º ‡§µ‡§ø‡§ú‡§º‡•Å‡§Ö‡§≤ ‡§¨‡•â‡§ï‡•ç‡§∏ */
        .visual-box { 
            position: absolute; right: 5%; top: 10%; width: 40%; height: 38%; 
            border: 5px solid #00f2ff; border-radius: 15px; overflow: hidden; 
            box-shadow: 0 0 40px rgba(0, 242, 255, 0.7); z-index: 5;
            animation: slideInRight 1s ease-out;
        }
        #newsImg { 
            width: 100%; height: 100%; object-fit: cover; 
            transition: opacity 1s ease-in-out, transform 0.5s ease-out; /* Smooth transition for image change */
        }

        /* ‡§¨‡§æ‡§à‡§Ç ‡§§‡§∞‡§´ ‡§ï‡•Ä ‡§∏‡•ç‡§ï‡•ç‡§∞‡•â‡§≤‡§ø‡§Ç‡§ó ‡§∏‡•ç‡§ï‡•ç‡§∞‡§ø‡§™‡•ç‡§ü ‡§µ‡§ø‡§Ç‡§°‡•ã */
        .script-window { 
            position: absolute; left: 5%; top: 10%; width: 38%; height: 55%; 
            background: rgba(0, 0, 0, 0.7); border-left: 8px solid #ff0000; 
            padding: 25px; box-sizing: border-box; z-index: 5; overflow: hidden;
            animation: slideInLeft 1s ease-out;
        }
        
        #teleprompter { 
            position: relative; font-size: 32px; line-height: 1.8; 
            color: #ffffff; text-align: left;
            top: 100%; /* Start from bottom */
        }

        /* ‡§è‡§Ç‡§ï‡§∞ ‡§µ‡•Ä‡§°‡§ø‡§Ø‡•ã */
        .anchor-container { 
            position: absolute; right: 0; bottom: 0; width: 55%; height: 95%; 
            z-index: 10; pointer-events: none;
            animation: slideInBottom 1s ease-out;
        }
        #anchorVid { width: 100%; height: 100%; object-fit: contain; }

        /* ‡§®‡•Ä‡§ö‡•á ‡§ï‡•Ä ‡§≤‡§æ‡§≤ ‡§™‡§ü‡•ç‡§ü‡•Ä (‡§ü‡§ø‡§ï‡§∞) */
        .ticker-bar { 
            position: absolute; bottom: 0; width: 100%; height: 80px; 
            background: linear-gradient(90deg, #ff0000 0%, #cc0000 100%); 
            display: flex; align-items: center; z-index: 20; border-top: 4px solid #fff;
            box-shadow: 0 -5px 20px rgba(255, 0, 0, 0.5);
        }
        marquee { 
            font-size: 38px; font-weight: bold; width: 100%; 
            color: #ffffff; text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
        }

        /* Basic Animations */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideInLeft { from { transform: translateX(-100%); } to { transform: translateX(0); } }
        @keyframes slideInRight { from { transform: translateX(100%); } to { transform: translateX(0); } }
        @keyframes slideInBottom { from { transform: translateY(100%); } to { transform: translateY(0); } }
    </style>
</head>
<body>

<div class="studio">
    <div class="visual-box"><img id="newsImg" src="https://image.pollinations.ai/prompt/news%20broadcast%20graphics?nologo=true"></div>

    <div class="script-window">
        <div id="teleprompter">PTN NEWS: ‡§Ö‡§™‡§®‡•Ä Google Sheet ‡§≤‡§ø‡§Ç‡§ï ‡§°‡§æ‡§≤‡•á‡§Ç ‡§î‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç...</div>
    </div>

    <div class="anchor-container"><video id="anchorVid" muted loop><source src="anchor_video.mp4" type="video/mp4"></video></div>
    <div class="ticker-bar"><marquee scrollamount="12" id="flashTicker">PTN NEWS: Loading data from Google Sheets...</marquee></div>
</div>

<script>
    const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTZcfTxhcB7LltOPkXuTBsQ4CRNa2KZfb6EQ2lxx-eXFVhACj3YI4mH4tSeTSx-K_Wf1sgk0419ZDkf/pub?output=csv"; // üî¥ ‡§Ö‡§™‡§®‡•Ä Google Sheet CSV ‡§≤‡§ø‡§Ç‡§ï ‡§Ø‡§π‡§æ‡§Å ‡§™‡•á‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç

    let newsItems = [];
    let currentNewsIndex = 0;
    let visualChangeInterval; // For auto-changing visuals

    async function loadNewsData() {
        try {
            const response = await fetch(csvUrl);
            const data = await response.text();
            
            const rows = data.split('\n').slice(1); 
            newsItems = rows.map(row => {
                const parts = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                return {
                    script: parts[0]?.replace(/"/g, "") || "",
                    visualKeywords: parts[1]?.replace(/"/g, "") || "",
                    flashText: parts[2]?.replace(/"/g, "") || ""
                };
            }).filter(item => item.script); // ‡§ñ‡§æ‡§≤‡•Ä ‡§∏‡•ç‡§ï‡•ç‡§∞‡§ø‡§™‡•ç‡§ü ‡§µ‡§æ‡§≤‡•Ä ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§π‡§ü‡§æ ‡§¶‡•á‡§Ç

            if (newsItems.length > 0) {
                document.getElementById("teleprompter").innerText = "‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡§ï‡•á ‡§®‡•ç‡§Ø‡•Ç‡§ú‡§º ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç!";
                document.getElementById("flashTicker").innerText = "PTN NEWS: ‡§≤‡•ã‡§° ‡§π‡•ã ‡§ó‡§Ø‡§æ ‡§π‡•à‡•§";
            } else {
                document.getElementById("teleprompter").innerText = "‡§ï‡•ã‡§à ‡§ñ‡§¨‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•Ä! ‡§∂‡•Ä‡§ü ‡§ö‡•á‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§";
            }
        } catch (e) {
            document.getElementById("teleprompter").innerText = "‡§è‡§∞‡§∞: ‡§∂‡•Ä‡§ü ‡§≤‡•ã‡§° ‡§®‡§π‡•Ä‡§Ç ‡§π‡•Å‡§à! ‡§≤‡§ø‡§Ç‡§ï ‡§Ø‡§æ ‡§∂‡•á‡§Ø‡§∞‡§ø‡§Ç‡§ó ‡§ö‡•á‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§";
            console.error("Error loading CSV:", e);
        }
    }

    function generateRandomVisualPrompt(baseKeyword) {
        const variants = [
            `${baseKeyword} - realistic news scene`,
            `${baseKeyword} - dramatic news report`,
            `${baseKeyword} - infographic style`,
            `${baseKeyword} - on a TV screen background`,
            `${baseKeyword} - breaking news banner`
        ];
        return variants[Math.floor(Math.random() * variants.length)];
    }

    function startBroadcasting() {
        if (newsItems.length === 0) {
            document.getElementById("teleprompter").innerText = "‡§ï‡•ã‡§à ‡§ñ‡§¨‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à!";
            return;
        }

        const currentStory = newsItems[currentNewsIndex];
        const prompterDiv = document.getElementById("teleprompter");
        const newsImage = document.getElementById("newsImg");
        const flashTicker = document.getElementById("flashTicker");
        const anchorVideo = document.getElementById("anchorVid");

        // UI ‡§Ö‡§™‡§°‡•á‡§ü‡•ç‡§∏
        prompterDiv.innerText = currentStory.script;
        flashTicker.innerText = "‡§¨‡•ç‡§∞‡•á‡§ï‡§ø‡§Ç‡§ó: " + currentStory.flashText;
        
        // ‡§µ‡§ø‡§ú‡•Å‡§Ö‡§≤ ‡§ö‡•á‡§Ç‡§ú‡§∞ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç
        let visualCounter = 0;
        clearInterval(visualChangeInterval); // ‡§™‡•Å‡§∞‡§æ‡§®‡§æ ‡§á‡§Ç‡§ü‡§∞‡§µ‡§≤ ‡§∏‡§æ‡§´ ‡§ï‡§∞‡•á‡§Ç
        visualChangeInterval = setInterval(() => {
            const prompt = generateRandomVisualPrompt(currentStory.visualKeywords);
            newsImage.style.opacity = 0.2; // Dim out for transition
            setTimeout(() => {
                newsImage.src = `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?nologo=true&width=800&height=450`;
                newsImage.style.opacity = 1; // Fade in new image
            }, 500); // 0.5s fade effect
            visualCounter++;
        }, 15000); // ‡§π‡§∞ 15 ‡§∏‡•á‡§ï‡§Ç‡§° ‡§Æ‡•á‡§Ç ‡§´‡•ã‡§ü‡•ã ‡§¨‡§¶‡§≤‡•á‡§ó‡•Ä

        // ‡§ü‡•á‡§≤‡•Ä‡§™‡•ç‡§∞‡•â‡§Æ‡•ç‡§™‡•ç‡§ü‡§∞ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•â‡§≤‡§ø‡§Ç‡§ó
        prompterDiv.style.top = "100%"; // Start from bottom
        prompterDiv.style.transition = 'none'; // No transition for reset
        prompterDiv.offsetHeight; // Force reflow
        
        window.speechSynthesis.cancel();
        const speechUtterance = new SpeechSynthesisUtterance(currentStory.script);
        speechUtterance.lang = 'hi-IN';
        speechUtterance.rate = 0.95; // Speaking speed

        speechUtterance.onstart = () => {
            anchorVideo.play();
            // Calculate scroll duration based on script length and speaking rate
            const words = currentStory.script.split(' ').length;
            const avgWordDuration = 60 / (150 * speechUtterance.rate); // Approx 150 words per minute at rate 1
            const totalScrollDuration = words * avgWordDuration * 1000; // in milliseconds

            prompterDiv.style.transition = `top ${totalScrollDuration / 1000}s linear`;
            prompterDiv.style.top = `-${prompterDiv.offsetHeight}px`; // Scroll to top
        };

        speechUtterance.onend = () => {
            anchorVideo.pause();
            clearInterval(visualChangeInterval); // ‡§∏‡•ç‡§ü‡•â‡§™ ‡§µ‡§ø‡§ú‡•Å‡§Ö‡§≤ ‡§ö‡•á‡§Ç‡§ú‡§∞
            currentNewsIndex = (currentNewsIndex + 1) % newsItems.length;
            setTimeout(startBroadcasting, 4000); // 4 ‡§∏‡•á‡§ï‡§Ç‡§° ‡§¨‡§æ‡§¶ ‡§Ö‡§ó‡§≤‡•Ä ‡§ñ‡§¨‡§∞
        };

        window.speechSynthesis.speak(speechUtterance);
    }

    // ‡§™‡•á‡§ú ‡§≤‡•ã‡§° ‡§π‡•ã‡§®‡•á ‡§™‡§∞ ‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç
    document.addEventListener('DOMContentLoaded', loadNewsData);

    // ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡§®‡•á ‡§™‡§∞ ‡§¨‡•ç‡§∞‡•â‡§°‡§ï‡§æ‡§∏‡•ç‡§ü ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç
    window.onclick = () => {
        if (!window.speechSynthesis.speaking && newsItems.length > 0) {
            startBroadcasting();
        }
    };
</script>
</body>
</html>
