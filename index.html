<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>PTN News Live - Final Studio</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; font-family: 'Segoe UI', Arial, sans-serif; }
        
        /* ‡§∏‡•ç‡§ü‡•Ç‡§°‡§ø‡§Ø‡•ã ‡§¨‡•à‡§ï‡§ó‡•ç‡§∞‡§æ‡§â‡§Ç‡§° */
        .studio { 
            position: relative; width: 100vw; height: 100vh; 
            background: url('studio.jpg') center/cover no-repeat; 
        }

        /* ‡§®‡•ç‡§Ø‡•Ç‡§ú‡§º ‡§µ‡§ø‡§ú‡§º‡•Å‡§Ö‡§≤ ‡§¨‡•â‡§ï‡•ç‡§∏ (‡§¶‡§æ‡§à‡§Ç ‡§ì‡§∞) */
        .visual-box { 
            position: absolute; right: 4%; top: 10%; width: 42%; height: 40%; 
            border: 4px solid #00f2ff; border-radius: 12px; overflow: hidden; 
            box-shadow: 0 0 25px rgba(0, 242, 255, 0.6); z-index: 2; background: #000;
        }
        #newsImg { width: 100%; height: 100%; object-fit: cover; transition: opacity 0.8s; }

        /* ‡§ü‡•á‡§≤‡•Ä‡§™‡•ç‡§∞‡•â‡§Æ‡•ç‡§™‡•ç‡§ü‡§∞ (‡§¨‡§æ‡§à‡§Ç ‡§ì‡§∞) */
        .script-window { 
            position: absolute; left: 4%; top: 10%; width: 40%; height: 55%; 
            background: rgba(0, 0, 0, 0.7); border-left: 8px solid #ff0000; 
            padding: 25px; box-sizing: border-box; z-index: 2; overflow: hidden;
        }
        #teleprompter { position: relative; font-size: 30px; line-height: 1.6; color: #fff; top: 100%; }

        /* ‡§è‡§Ç‡§ï‡§∞ ‡§∏‡•ç‡§Æ‡§æ‡§∞‡•ç‡§ü ‡§™‡•ã‡§ú‡•Ä‡§∂‡§®‡§ø‡§Ç‡§ó (Anchor Logical Fit) */
        .anchor-box { 
            position: absolute; 
            left: 0; right: 0; bottom: 0; /* ‡§®‡•Ä‡§ö‡•á ‡§∏‡•á ‡§ö‡§ø‡§™‡§ï‡§æ ‡§π‡•Å‡§Ü */
            width: 100%; height: 100%; 
            display: flex; justify-content: flex-end; align-items: flex-end;
            z-index: 10; pointer-events: none; 
        }
        #anchorCanvas { 
            max-width: 65%; max-height: 95%; /* ‡§è‡§Ç‡§ï‡§∞ ‡§ï‡•ã ‡§¨‡§π‡•Å‡§§ ‡§¨‡•ú‡§æ ‡§π‡•ã‡§®‡•á ‡§∏‡•á ‡§∞‡•ã‡§ï‡§§‡§æ ‡§π‡•à */
            object-fit: contain; 
        }
        #hiddenVid { display: none; }

        /* ‡§®‡•ç‡§Ø‡•Ç‡§ú‡§º ‡§ü‡§ø‡§ï‡§∞ */
        .ticker-bar { 
            position: absolute; bottom: 0; width: 100%; height: 80px; 
            background: linear-gradient(90deg, #ff0000, #800000); 
            display: flex; align-items: center; z-index: 20; border-top: 4px solid #fff; 
        }
        marquee { font-size: 36px; font-weight: bold; color: white; width: 100%; }
    </style>
</head>
<body>

<div class="studio">
    <div class="visual-box">
        <img id="newsImg" src="https://image.pollinations.ai/prompt/breaking%20news%20live?nologo=true">
    </div>

    <div class="script-window">
        <div id="teleprompter">PTN NEWS: ‡§∏‡§Æ‡§æ‡§ö‡§æ‡§∞ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡•á ‡§π‡•à‡§Ç, ‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç...</div>
    </div>
    
    <div class="anchor-box">
        <canvas id="anchorCanvas"></canvas>
    </div>
    
    <video id="hiddenVid" muted loop crossorigin="anonymous">
        <source src="anchor_video.mp4" type="video/mp4">
    </video>

    <div class="ticker-bar">
        <marquee scrollamount="12" id="flashTicker">PTN NEWS: ‡§∏‡§§‡•ç‡§Ø‡§§‡§æ ‡§π‡•Ä ‡§π‡§Æ‡§æ‡§∞‡•Ä ‡§™‡§π‡§ö‡§æ‡§®...</marquee>
    </div>
</div>

<script>
    const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTZcfTxhcB7LltOPkXuTBsQ4CRNa2KZfb6EQ2lxx-eXFVhACj3YI4mH4tSeTSx-K_Wf1sgk0419ZDkf/pub?output=csv"; // üî¥ ‡§Ø‡§π‡§æ‡§Å ‡§Ö‡§™‡§®‡•Ä CSV ‡§≤‡§ø‡§Ç‡§ï ‡§°‡§æ‡§≤‡•á‡§Ç

    let newsItems = [];
    let newsIndex = 0;
    let visualInterval;

    const video = document.getElementById('hiddenVid');
    const canvas = document.getElementById('anchorCanvas');
    const ctx = canvas.getContext('2d');

    // üü¢ ‡§ï‡•ç‡§∞‡•ã‡§Æ‡§æ ‡§ï‡•Ä ‡§î‡§∞ ‡§è‡§Ç‡§ï‡§∞ ‡§∞‡•á‡§Ç‡§°‡§∞‡§ø‡§Ç‡§ó
    function renderAnchor() {
        if (video.paused || video.ended) return;
        
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        let frame = ctx.getImageData(0, 0, canvas.width, canvas.height);
        let l = frame.data.length / 4;

        for (let i = 0; i < l; i++) {
            let r = frame.data[i * 4 + 0];
            let g = frame.data[i * 4 + 1];
            let b = frame.data[i * 4 + 2];
            
            // Green Screen Logic
            if (g > 90 && g > r * 1.3 && g > b * 1.3) {
                frame.data[i * 4 + 3] = 0; 
            }
        }
        ctx.putImageData(frame, 0, 0);
        requestAnimationFrame(renderAnchor);
    }

    async function loadSheets() {
        try {
            const response = await fetch(csvUrl);
            const data = await response.text();
            const rows = data.split('\n').slice(1);
            newsItems = rows.map(r => {
                const c = r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                return { 
                    script: c[0]?.replace(/"/g,"").trim(), 
                    visual: c[1]?.replace(/"/g,"").trim(), 
                    flash: c[2]?.replace(/"/g,"").trim() 
                };
            }).filter(i => i.script);
            
            if(newsItems.length > 0) startBroadcasting();
        } catch(e) { console.log("Sheet load error"); }
    }

    function startBroadcasting() {
        const current = newsItems[newsIndex];
        const prompter = document.getElementById("teleprompter");
        const newsImg = document.getElementById("newsImg");

        // UI Reset
        prompter.style.transition = "none";
        prompter.style.top = "100%";
        prompter.innerText = current.script;
        document.getElementById("flashTicker").innerText = "PTN BREAKING: " + current.flash;
        
        // Visual Logic Fix
        clearInterval(visualInterval);
        const updateVisual = () => {
            const seed = Math.floor(Math.random() * 9999);
            newsImg.style.opacity = "0.3";
            setTimeout(() => {
                newsImg.src = `https://image.pollinations.ai/prompt/news%20scene%20of%20${encodeURIComponent(current.visual)}?nologo=true&seed=${seed}&width=800&height=450`;
                newsImg.style.opacity = "1";
            }, 500);
        };
        updateVisual();
        visualInterval = setInterval(updateVisual, 15000);

        // Audio and Scroll
        window.speechSynthesis.cancel();
        const msg = new SpeechSynthesisUtterance(current.script);
        msg.lang = 'hi-IN';
        msg.rate = 0.9;

        msg.onstart = () => {
            video.play();
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            renderAnchor();
            
            // Scroll Speed Logic
            setTimeout(() => {
                const duration = current.script.length * 0.12;
                prompter.style.transition = `top ${duration}s linear`;
                prompter.style.top = `-${prompter.offsetHeight + 100}px`;
            }, 100);
        };

        msg.onend = () => {
            video.pause();
            newsIndex = (newsIndex + 1) % newsItems.length;
            setTimeout(startBroadcasting, 3000);
        };

        window.speechSynthesis.speak(msg);
    }

    window.onclick = () => {
        if(newsItems.length === 0) loadSheets();
    };
</script>
</body>
</html>
